---
title: " "
output:
  pdf_document:
    # citation_package: natbib
    # number_sections: TRUE
    # keep_tex: TRUE
bibliography: bib.bib
link-citations: TRUE
csl: Chicago.csl
geometry: "left  =  2cm, right  =  2cm, top  =  2.5cm, bottom  =  2.5cm"
fontsize: 12pt
header-includes:
  - \usepackage{enumitem}
  - \usepackage{float}
  - \usepackage{sectsty}
  - \usepackage{paralist}
  - \usepackage{setspace}\spacing{1.5}
  - \usepackage{fancyhdr}
  - \usepackage{lastpage}
  - \usepackage{dcolumn}
  - \usepackage{ragged2e}
  - \usepackage{graphicx}
  - \usepackage{amsmath}
  - \usepackage[nottoc, numbib]{tocbibind}
  - \usepackage{wrapfig}
  - \floatplacement{figure}{H}
fig_caption: true 
fig_crop: true
highlight: "tango"
linkcolor: blue
urlcolor: blue
citecolor: black
df_print: kable
---

```{r include = FALSE}
knitr::opts_chunk$set(
	echo  =  FALSE,
	fig.show  =  TRUE,
	message  =  FALSE,
	warning  =  FALSE,
	fig.pos = 'H'
)
options(tinytex.verbose = TRUE)
```

```{r}
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk  =  function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size  !=   "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
```

```{r}
pacman::p_load(pacman, tidyverse, GADMTools)
```

<style>
body {
text-align: justify}
</style>

\allsectionsfont{\centering}
\subsectionfont{\centering}
\subsubsectionfont{\justifying}

\pagenumbering{gobble}

\begin{FlushRight}

\vspace{0cm}

```{r uni_logo, out.width = "50%"}
knitr::include_graphics("LogoUni.png")
```

\end{FlushRight}

\begin{centering}

\vspace{4,5cm}

\Large

\doublespacing
{\bf MODELING EXTREME PRECIPITATION EVENTS\\A THESIS PAPER FOR THE DEGREE OF \\BACHELOR OF SCIENCE} 
\singlespacing

{\ Wintersemester 2022}

\normalsize
\singlespacing

By

\Large
\singlespacing
{\ Ekin Gülhan}

\end{centering}

\begin{FlushLeft}

\vspace{3,5cm}

\Large
\singlespacing
\normalsize
Supervisor: Dr. Isa Marques \\Enrolment number: 21675680 \\e-mail: ekin.guelhan(at)stud.uni-goettingen.de \\Address: Hannoversche Straße 134, 37077 Göttingen \\Date: `r Sys.Date()` 

\end{FlushLeft}

\newpage 

\centering
\raggedright
\hypersetup{linkcolor = black}
\tableofcontents

\newcounter{savepage}
\cleardoublepage
\pagenumbering{Roman}

\newpage

\cleardoublepage
\setcounter{savepage}{\arabic{page}}
\pagenumbering{arabic}

```{r}
options(scipen = 999, OutDec  =  ",")
```

\justifying

<!-- Here follows code for preparing the expose as a whole and the introduction in particular -->
```{r}
# getwd()

# Load the data
load("WeatherGermany.rda")

# reformat the id column as numeric values
WeatherGermany$id = as.numeric(WeatherGermany$id)

# Create a list of all weather stations
ListOfAllWeatherStations = data.frame("Names of weather stations" = unique(WeatherGermany$name))

# Create a list of all unique ids of the german weather stations
ListOfAllUniqueIDs = data.frame(unique(data.frame(WeatherGermany$id)))

# Create a list of unique pairs of angular coordinates, where each pair represents a weather station 
ListOfAllUniqueCoordinates = data.frame(unique(data.frame(WeatherGermany$lon,WeatherGermany$lat)))

# Change format of the index column to factor/categorical
WeatherGermany$index = as.numeric(factor(WeatherGermany$name))

# Change the name of the columns of the list of unique pairs of coordinates
colnames(ListOfAllUniqueCoordinates) = c("longitude","latitude")

# Relocate the index column before the id column 
WeatherGermany = WeatherGermany %>% relocate(index,.before = id)

# Order the Data based the values of the name column in an increasing way
WeatherGermany = WeatherGermany[order(WeatherGermany$name),]

# Delete the id column, as the index column is a better substitute for it 
WeatherGermany = subset(WeatherGermany, select = -c(id) )

# Substitute all values "-999" as NAs, since this number is indeed code for not available
WeatherGermany = WeatherGermany %>%
   mutate(across(where(is.numeric), ~na_if(., -999)))

# Count the number of observations of daily resolution each weather station made
NumberOfObservationsPerWeatherStation = data.frame(count(WeatherGermany, index))

# Compute the latest year of observation among all the weather stations
MaximumYear = max(WeatherGermany$year, na.rm = TRUE)

# Compute the earliest year of observation among all the weather stations
MinimumYear = min(WeatherGermany$year, na.rm = TRUE)

# Compute the spatial coverage among all the weather stations
RangeOfSpatialCoverage = MaximumYear - MinimumYear

# Compute the empirical distribution of the number of observations, meaning the 4 quartiles 
{
DistributionNumberOfObservations = summary(NumberOfObservationsPerWeatherStation$n)
}

# Compute the boundaries for the classification of an PE as an EPE in terms of the 5th and 95th percentile of precipitation height
{
ExtremePrecipitationClassificationBoundaries = data.frame("Classification Boundaries"= quantile(WeatherGermany$rain,probs = c(0.05,0.95),na.rm = TRUE))
}

# Create a new variable that indicates the occurence of an EPE based on the arbitrary boundaries from above and the data on precipitation heigt
{
WeatherGermany = 
  WeatherGermany %>% mutate(ExtremePrecipitationEvent = 
                              case_when(WeatherGermany$rain >= ExtremePrecipitationClassificationBoundaries[2,1]  ~ 1,
                                        WeatherGermany$rain >= ExtremePrecipitationClassificationBoundaries[1,1] & WeatherGermany$rain < ExtremePrecipitationClassificationBoundaries[2,1] ~ 0))
}

# Create a table that recounts that contrasts the number of observations of a weather stations with its' index number
NumberOfObservationsPerWeatherStation = data.frame(count(WeatherGermany, index))


```


\newpage

# Session Info

```{r}
sessionInfo()
```

\newpage
